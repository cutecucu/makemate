<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>나만의 캐릭터 파츠 만들기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: none;
        }
        #sketchbook {
            background-color: #f9fafb;
            border: 2px dashed #d1d5db;
            cursor: default;
            overflow: hidden;
        }
        #sketchbook.drawing-mode {
            cursor: crosshair;
        }
        .part-item {
            cursor: grab;
            transition: transform 0.1s ease-in-out, box-shadow 0.1s;
        }
        .part-item:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        .draggable-item {
            cursor: move;
        }
        .selection-box {
            fill: none;
            stroke: #3b82f6;
            stroke-width: 2px;
            stroke-dasharray: 6 4;
        }
        .resize-handle {
            fill: #3b82f6;
            stroke: white;
            stroke-width: 2px;
        }
        .rotation-handle {
            fill: #f59e0b;
            stroke: white;
            stroke-width: 2px;
            cursor: alias;
        }
        .rotation-line {
            stroke: #a1a1aa;
            stroke-width: 2px;
        }
        #color-palette .color-swatch {
            transition: transform 0.1s ease-in-out;
        }
        #color-palette .color-swatch:hover {
            transform: scale(1.1);
        }
        #draw-shape-btn.active, #draw-line-btn.active, #set-center-btn.active, #multi-select-btn.active, .mobile-tab.active {
            background-color: #3b82f6;
            color: white;
        }
        #center-point-element, #modal-center-point {
            cursor: move;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 500px;
        }
    </style>
</head>
<body class="bg-slate-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-7xl bg-white rounded-2xl shadow-lg p-6 flex flex-col">
        <header class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl md:text-3xl font-bold text-gray-800">나만의 캐릭터 파츠 만들기</h1>
                <p class="text-sm md:text-base text-gray-500 mt-1">파츠를 클릭해 추가하고 캐릭터를 만들어보세요!</p>
            </div>
            <img src="https://cutecucu.github.io/makemate/shapecharactor/makematelogo.png" alt="로고" class="rounded-lg w-[70px] h-[70px]">
        </header>

        <div class="flex flex-col md:flex-row gap-6 w-full">
            
            <!-- 왼쪽 팔레트 (데스크톱) -->
            <aside id="left-palette" class="hidden md:block w-full md:w-1/4 bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-y-auto md:max-h-[75vh]"></aside>

            <!-- 중앙 컨텐츠 -->
            <div class="flex-1 flex flex-col">
                <main class="w-full h-[50vh] md:h-[600px] rounded-lg shadow-inner">
                    <svg id="sketchbook" width="100%" height="100%"></svg>
                </main>

                <div id="color-controls" class="hidden mt-6 p-4 bg-gray-100 rounded-lg">
                    <h3 class="font-semibold text-gray-700 mb-3 text-center">색상 변경</h3>
                    <div id="color-palette" class="flex flex-wrap gap-3 justify-center">
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #ef4444;" data-color="#ef4444"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #f97316;" data-color="#f97316"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #fde047;" data-color="#fde047"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #4ade80;" data-color="#4ade80"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #38bdf8;" data-color="#38bdf8"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #60a5fa;" data-color="#60a5fa"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #a78bfa;" data-color="#a78bfa"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #f472b6;" data-color="#f472b6"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #a16207;" data-color="#a16207"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #f9fafb;" data-color="#f9fafb"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #9ca3af;" data-color="#9ca3af"></div>
                         <div class="color-swatch w-8 h-8 rounded-full cursor-pointer border-2 border-white shadow" style="background-color: #1f2937;" data-color="#1f2937"></div>
                    </div>
                </div>

                <div class="flex justify-center flex-wrap gap-2 md:gap-4 mt-6">
                    <button id="multi-select-btn" class="px-3 py-2 text-sm md:text-base bg-white text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200">다중 선택</button>
                    <button id="draw-shape-btn" class="px-3 py-2 text-sm md:text-base bg-white text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200">면 그리기</button>
                    <button id="draw-line-btn" class="px-3 py-2 text-sm md:text-base bg-white text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200">선 그리기</button>
                    <button id="set-center-btn" class="px-3 py-2 text-sm md:text-base bg-white text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200">중심점</button>
                    <label for="image-upload" class="cursor-pointer px-3 py-2 text-sm md:text-base bg-white text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200">이미지</label>
                    <input type="file" id="image-upload" class="hidden" accept="image/png, image/jpeg, image/svg+xml">
                    <button id="save-btn" class="px-4 py-2 text-sm md:text-base bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200">전체 저장</button>
                    <button id="save-selection-btn" class="hidden px-4 py-2 text-sm md:text-base bg-teal-600 text-white font-semibold rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200">선택 저장</button>
                    <button id="clear-btn" class="px-4 py-2 text-sm md:text-base bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-400 transition-all duration-200">모두 삭제</button>
                    <a id="download-link" style="display: none;"></a>
                </div>
            </div>

            <!-- 오른쪽 팔레트 (데스크톱) -->
            <aside id="right-palette" class="hidden md:block w-full md:w-1/4 bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-y-auto md:max-h-[75vh]"></aside>
        </div>
    </div>
    
    <!-- Palette Contents (Template) -->
    <div id="palette-contents" class="hidden">
        <div data-content-for="shapes">
            <h3 class="font-bold text-lg mb-3 text-gray-700">도형</h3>
            <div class="flex flex-wrap gap-4 items-center" data-category="shapes">
                <div class="part-item w-16 h-16 bg-blue-300 rounded-xl" data-shape="rect-round"></div>
                <div class="part-item w-16 h-16 bg-yellow-300 rounded-full" data-shape="circle"></div>
                <div class="part-item w-24 h-12 bg-green-300 rounded-full" data-shape="capsule"></div>
                <svg class="part-item" data-shape="triangle-round" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M 50,10 L 90,90 L 10,90 Z" fill="#fb923c"/></svg>
                <svg class="part-item" data-shape="star-round" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M50 2l11 35h37l-30 22 11 36-30-22-29 22 12-36-30-22h37z" fill="#facc15"/></svg>
                <svg class="part-item" data-shape="heart" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M50 85 C-20 40, 25 -10, 50 20 C75 -10, 120 40, 50 85 Z" fill="#ef4444"/></svg>
                <svg class="part-item" data-shape="hexagon-round" width="64" height="60" viewBox="0 0 100 87"><path class="colorable" d="M25 0 L75 0 L100 43.5 L75 87 L25 87 L0 43.5 Z" fill="#60a5fa"/></svg>
                <svg class="part-item" data-shape="half-circle" width="64" height="32" viewBox="0 0 100 50"><path class="colorable" d="M0 50 A50 50 0 0 1 100 50 Z" fill="#34d399"/></svg>
                <svg class="part-item" data-shape="rhombus-round" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M50 0 L100 50 L50 100 L0 50 Z" fill="#a78bfa"/></svg>
                <svg class="part-item" data-shape="pentagon-round" width="64" height="64" viewBox="0 0 100 95"><path class="colorable" d="M50 0 L100 38 L82 95 L18 95 L0 38 Z" fill="#f472b6"/></svg>
                <svg class="part-item" data-shape="octagon-round" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M30 0 L70 0 L100 30 L100 70 L70 100 L30 100 L0 70 L0 30 Z" fill="#22d3ee"/></svg>
                <svg class="part-item" data-shape="cross-round" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M30 0 L70 0 L70 30 L100 30 L100 70 L70 70 L70 100 L30 100 L30 70 L0 70 L0 30 L30 30 Z" fill="#f87171"/></svg>
                <svg class="part-item" data-shape="arrow-round" width="64" height="48" viewBox="0 0 100 75"><path class="colorable" d="M0 25 L50 25 L50 0 L100 37.5 L50 75 L50 50 L0 50 Z" fill="#4ade80"/></svg>
                <svg class="part-item" data-shape="moon" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M50 0 A50 50 0 1 0 50 100 A40 40 0 1 1 50 0 Z" fill="#fde047"/></svg>
                <svg class="part-item" data-shape="cloud" width="64" height="48" viewBox="0 0 100 60"><path class="colorable" d="M15 60 Q5 40 25 35 Q30 10 55 25 Q75 15 85 35 Q105 45 90 60 Z" fill="#93c5fd"/></svg>
                <svg class="part-item" data-shape="drop" width="48" height="64" viewBox="0 0 75 100"><path class="colorable" d="M37.5 0 C0 0 0 60 37.5 100 C75 60 75 0 37.5 0 Z" fill="#38bdf8"/></svg>
                <svg class="part-item" data-shape="speech-bubble" width="64" height="56" viewBox="0 0 100 88"><path class="colorable" d="M0 10 C0 4.477 4.477 0 10 0 L90 0 C95.523 0 100 4.477 100 10 L100 60 C100 65.523 95.523 70 90 70 L30 70 L15 88 L20 70 L10 70 C4.477 70 0 65.523 0 60 Z" fill="#e5e7eb"/></svg>
                <svg class="part-item" data-shape="donut" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" fill-rule="evenodd" d="M 50, 0 a 50,50 0 1,0 0,100 a 50,50 0 1,0 0,-100 z M 50,20 a 30,30 0 1,1 0,60 a 30,30 0 1,1 0,-60 z" fill="#f9a8d4"/></svg>
                <svg class="part-item" data-shape="blob" width="64" height="60" viewBox="0 0 100 94"><path class="colorable" d="M85.3,62.3c9.9,20.5-12.8,32.3-30.6,31.2c-17.8-1.1-29-20.5-23.5-38.3c5.5-17.8,29.9-19.8,42.5-13.3 C86.4,48.4,75.4,41.7,85.3,62.3z" fill="#c4b5fd"/></svg>
                <div class="part-item w-16 h-12 bg-teal-300" style="clip-path: polygon(25% 0%, 75% 0%, 100% 100%, 0% 100%); border-radius: 8px;" data-shape="trapezoid-round"></div>
            </div>
        </div>
        <div data-content-for="lines">
            <h3 class="font-bold text-lg mb-3 text-gray-700">선</h3>
            <div class="flex flex-wrap gap-4 items-center" data-category="lines">
                <svg class="part-item" data-shape="line-curved" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 80 Q 50 20 90 80" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-zigzag" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 L 30 25 L 50 75 L 70 25 L 90 50" stroke="black" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <svg class="part-item" data-shape="line-check" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M20 50 L 45 75 L 80 25" stroke="green" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <svg class="part-item" data-shape="line-pig-tail" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M20,50 C20,20 80,20 80,50 C80,80 20,80 20,50 C20,35 65,35 65,50 C65,65 35,65 35,50" stroke="#f472b6" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-wavy" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 C 30 20, 50 80, 70 20, 90 50" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-dashed" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 L 90 50" stroke="black" stroke-width="5" fill="none" stroke-linecap="round" stroke-dasharray="15, 10"/></svg>
                <svg class="part-item" data-shape="line-spiral" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M50 50 m0 -40 a40 40 0 1 1 0 80 a30 30 0 1 0 0 -60 a20 20 0 1 1 0 40 a10 10 0 1 0 0 -20" stroke="black" stroke-width="5" fill="none"/></svg>
                <svg class="part-item" data-shape="line-dotted" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 L 90 50" stroke="black" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="2, 12"/></svg>
                <svg class="part-item" data-shape="line-double" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 40 L 90 40 M10 60 L 90 60" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-scribble" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 C20 20, 30 80, 40 50 S60 20, 70 50 S80 80, 90 50" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-lightning" width="64" height="64" viewBox="0 0 100 100"><path class="colorable" d="M40 0 L20 50 L45 50 L30 100 L80 40 L55 40 Z" fill="#fef08a"/></svg>
                <svg class="part-item" data-shape="line-stitched" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 L 90 50" stroke="#a16207" stroke-width="5" fill="none" stroke-linecap="round" stroke-dasharray="15, 10, 2, 10"/></svg>
                <svg class="part-item" data-shape="line-looped" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 C10 30, 30 30, 30 50 C30 70, 50 70, 50 50 C50 30, 70 30, 70 50 C70 70, 90 70, 90 50" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-spring" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 L 20 50 C25 25, 35 75, 40 50 C45 25, 55 75, 60 50 C65 25, 75 75, 80 50 L 90 50" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="line-heartbeat" width="64" height="64" viewBox="0 0 100 100"><path class="stroke-colorable" d="M10 50 L 30 50 L 35 40 L 45 60 L 50 50 L 55 55 L 60 50 L 90 50" stroke="red" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <svg class="part-item" data-shape="mouth-smile" width="64" height="32" viewBox="0 0 100 50"><path class="stroke-colorable" d="M10 20 Q 50 50 90 20" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="mouth-sad" width="64" height="32" viewBox="0 0 100 50"><path class="stroke-colorable" d="M10 30 Q 50 0 90 30" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="mouth-open" width="64" height="40" viewBox="0 0 100 60"><path class="colorable" d="M10 20 Q 50 60 90 20 Z" fill="black"/></svg>
                <svg class="part-item" data-shape="mouth-straight" width="64" height="32" viewBox="0 0 100 50"><path class="stroke-colorable" d="M10 25 L 90 25" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="mustache" width="64" height="32" viewBox="0 0 100 50"><path class="colorable" d="M5 25 C 20 0, 30 0, 50 25 C 70 0, 80 0, 95 25" fill="black"/></svg>
            </div>
        </div>
        <div data-content-for="eyes">
            <h3 class="font-bold text-lg mb-3 text-gray-700">눈</h3>
            <div class="flex flex-wrap gap-4 items-center" data-category="eyes">
                <svg class="part-item" data-shape="eye-basic" width="40" height="40" viewBox="0 0 60 60"><g><circle class="colorable" cx="30" cy="30" r="15" fill="black"/><circle cx="35" cy="25" r="5" fill="white"/></g></svg>
                <svg class="part-item" data-shape="eye-closed" width="40" height="40" viewBox="0 0 60 60"><g><path class="stroke-colorable" d="M10 30 Q 30 45 50 30" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></g></svg>
                <svg class="part-item" data-shape="eye-surprised" width="40" height="40" viewBox="0 0 60 60"><g><circle class="colorable" cx="30" cy="30" r="20" fill="white"/><circle class="colorable" cx="30" cy="30" r="8" fill="black"/></g></svg>
                <svg class="part-item" data-shape="eye-wink" width="40" height="40" viewBox="0 0 60 60"><g><path class="stroke-colorable" d="M10 30 Q 30 15 50 30" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></g></svg>
                <svg class="part-item" data-shape="eye-sparkle" width="40" height="40" viewBox="0 0 60 60"><g><circle class="colorable" cx="30" cy="30" r="15" fill="black"/><path d="M25 20 L30 15 L35 20 L40 25 L35 30 L30 35 L25 30 Z" fill="white"/><circle cx="40" cy="35" r="3" fill="white"/></g></svg>
                <svg class="part-item" data-shape="eye-angry" width="40" height="40" viewBox="0 0 60 60"><path class="stroke-colorable" d="M10 40 L50 20" stroke="black" stroke-width="6" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="eye-dizzy" width="40" height="40" viewBox="0 0 60 60"><path class="stroke-colorable" d="M15 15 L45 45 M45 15 L15 45" stroke="black" stroke-width="6" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="eye-crying" width="40" height="48" viewBox="0 0 60 72"><path class="stroke-colorable" d="M10 30 Q 30 45 50 30" stroke="black" stroke-width="5" fill="none" /><path class="colorable" d="M30 35 C20 50, 20 60, 30 70 C40 60, 40 50, 30 35 Z" fill="#3b82f6"/></svg>
                <svg class="part-item" data-shape="eye-heart" width="40" height="40" viewBox="0 0 60 60"><path class="colorable" d="M30 50 C-10 20, 15 -10, 30 10 C45 -10, 70 20, 30 50 Z" fill="#ef4444"/></svg>
                <svg class="part-item" data-shape="eye-side" width="40" height="40" viewBox="0 0 60 60"><circle class="colorable" cx="30" cy="30" r="18" fill="white"/><circle class="colorable" cx="40" cy="30" r="8" fill="black"/></svg>
                <svg class="part-item" data-shape="eye-sleepy" width="40" height="40" viewBox="0 0 60 60"><path class="stroke-colorable" d="M10 35 L50 35" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="eye-skeptical" width="40" height="40" viewBox="0 0 60 60"><circle class="colorable" cx="30" cy="30" r="10" fill="black"/><path class="stroke-colorable" d="M10 20 Q 30 10 50 20" stroke="black" stroke-width="5" fill="none" stroke-linecap="round"/></svg>
                <svg class="part-item" data-shape="eye-scared" width="40" height="40" viewBox="0 0 60 60"><circle class="colorable" cx="30" cy="30" r="20" fill="white"/><circle class="colorable" cx="30" cy="30" r="12" fill="black"/><circle cx="33" cy="27" r="4" fill="white"/></svg>
                <svg class="part-item" data-shape="eye-cute" width="40" height="40" viewBox="0 0 60 60"><circle class="colorable" cx="30" cy="30" r="25" fill="black"/><circle cx="22" cy="22" r="8" fill="white"/><circle cx="38" cy="38" r="4" fill="white"/></svg>
                <svg class="part-item" data-shape="eye-robot" width="40" height="40" viewBox="0 0 60 60"><rect class="colorable" x="10" y="10" width="40" height="40" fill="black" rx="5"/><rect class="colorable" x="25" y="25" width="10" height="10" fill="red"/></svg>
                <svg class="part-item" data-shape="eye-cat" width="40" height="40" viewBox="0 0 60 60"><ellipse class="colorable" cx="30" cy="30" rx="25" ry="20" fill="yellow"/><ellipse class="colorable" cx="30" cy="30" rx="5" ry="18" fill="black"/></svg>
                <svg class="part-item" data-shape="eye-spiral" width="40" height="40" viewBox="0 0 60 60"><path class="stroke-colorable" d="M30 30 m0 -25 a25 25 0 1 1 0 50 a20 20 0 1 0 0 -40 a15 15 0 1 1 0 30 a10 10 0 1 0 0 -20 a5 5 0 1 1 0 10" stroke="black" stroke-width="4" fill="none"/></svg>
                <svg class="part-item" data-shape="eye-starry" width="40" height="40" viewBox="0 0 60 60"><path class="colorable" d="M30 5 L37 23 L56 23 L41 35 L48 53 L30 42 L12 53 L19 35 L4 23 L23 23 Z" fill="yellow"/></svg>
                <svg class="part-item" data-shape="eye-no-pupil" width="40" height="40" viewBox="0 0 60 60"><circle class="colorable" cx="30" cy="30" r="20" fill="white"/></svg>
                <svg class="part-item" data-shape="eye-brow" width="40" height="20" viewBox="0 0 60 30"><path class="stroke-colorable" d="M10 25 Q 30 5 50 25" stroke="black" stroke-width="8" fill="none" stroke-linecap="round"/></svg>
            </div>
        </div>
    </div>
    
    <!-- Mobile Bottom Sheet Palette -->
    <div id="mobile-palette-sheet" class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg rounded-t-2xl p-4 transform translate-y-full transition-transform duration-300 z-40">
        <div class="flex justify-between items-center mb-4">
            <h3 id="mobile-palette-title" class="font-bold text-lg text-gray-700"></h3>
            <button id="close-mobile-palette" class="text-gray-500 hover:text-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="mobile-palette-content" class="overflow-y-auto max-h-48">
            <!-- JS will populate this -->
        </div>
    </div>

    <!-- Mobile Bottom Tab Bar -->
    <div id="mobile-palette-tabs" class="md:hidden fixed bottom-0 left-0 right-0 bg-gray-100 border-t border-gray-200 flex justify-around p-1 z-50">
        <button data-palette="shapes" class="mobile-tab flex-1 flex flex-col items-center text-gray-600 p-2 rounded-lg">
             <svg class="w-6 h-6 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
            <span class="text-xs">도형</span>
        </button>
        <button data-palette="lines" class="mobile-tab flex-1 flex flex-col items-center text-gray-600 p-2 rounded-lg">
            <svg class="w-6 h-6 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.174 6.812a1 1 0 0 0-1.342-1.342L16.5 8.804l-1.454-1.454a1 1 0 0 0-1.414 0L10.5 10.5l-1.836-1.836a1 1 0 0 0-1.414 0l-2.046 2.046a1 1 0 0 0 0 1.414l2.046 2.046a1 1 0 0 0 1.414 0L10.5 13.5l2.132 2.132a1 1 0 0 0 1.414 0l3.126-3.126 3.126-3.126a1 1 0 0 0 0-1.414l-1.12-1.12z"></path></svg>
            <span class="text-xs">선</span>
        </button>
        <button data-palette="eyes" class="mobile-tab flex-1 flex flex-col items-center text-gray-600 p-2 rounded-lg">
            <svg class="w-6 h-6 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="text-xs">눈</span>
        </button>
    </div>

    <script>
        // ... (The entire JavaScript code is here) ...
    </script>
</body>
</html>

